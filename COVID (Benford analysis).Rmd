```{r}
pacman::p_load(tidyverse, here, htmltab, janitor, benford.analysis)
```

# COVID data integrity

## The Economist Intelligence Unit: Democracy Index

```{r}
democracy <- 
  htmltab("https://en.wikipedia.org/wiki/Democracy_Index", 6) %>% 
  as_tibble() %>% 
  clean_names() %>% 
  # rename_with(~str_remove(., "x")) %>% 
  select(country, region, "regime" = regime_type, 
         everything(), -c(x2020_rank))
```

## Our World in Data: COVID time series

```{r}
covid <- 
  read_csv("https://github.com/owid/covid-19-data/blob/master/public/data/owid-covid-data.csv?raw=true") %>% 
  select(iso_code, continent, location, date, 
         new_cases, new_deaths, new_tests, new_vaccinations,
         population, extreme_poverty, human_development_index)
```

## Benford analysis

```{r}
covid %>% filter(new_cases < 0) %>% count()
```

Do I need to remove NA's from the vector?

```{r}
benford <- benford(covid %>% pull(new_cases))
plot(benford)
```

```{r}
benford <- benford(covid %>% 
                     filter(iso_code == "CHE") %>%
                     pull(new_cases), 1, sign = "positive")

madiff <- 
  suspectsTable(benford) %>% 
  as_tibble() %>% 
  select("absolute.diff") %>% 
  summarise(mean = mean(absolute.diff)) %>% 
  pull()

madiff
MAD(benford)
```

```{r}
# GTM
13.72744
0.02076768

# USA
12.95244
0.01860983

# CHN
15.90707
0.02240432

# SWE
12.92031
0.02827202

# CHE
8.820274
0.01639456
```
